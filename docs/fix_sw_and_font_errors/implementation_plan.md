# 実装計画：Service Worker とフォント設定の修正

## 1. 目的
- デプロイ後の古いキャッシュによる `ChunkLoadError` (404) を防止する。
- 未使用のプリロードフォントに関する警告を解消し、デザイン意図通りのフォントを適用する。

## 2. 変更内容

### 2.1 Service Worker (`public/sw.js`)
- **キャッシュ名の更新**: `nofap-ai-v1.1` に変更して古いキャッシュを無効化しやすくする。
- **キャッシュ戦略の変更**:
  - HTML (Navigation requests) は `Network First` 戦略に変更。オンライン時は常に最新を取得し、オフライン時のみキャッシュを利用する。
  - 静的資産（JS, CSS, 画像）は `Cache First` を継続するが、HTML が最新であれば新しいハッシュ値のファイルを正しく読み込めるようになる。
- **古いキャッシュの削除**: `activate` イベントを追加し、古い `CACHE_NAME` のキャッシュを自動で削除する。

### 2.2 CSS (`app/globals.css`)
- `body` 要素のフォントファミリー設定に `var(--font-sans)` を明示的に指定し、プリロードされた Geist フォントが実際に使用されるようにする。

## 3. 影響範囲
- PWA 機能（オフライン閲覧）
- サイト全体のフォントレンダリング

## 4. リスク
- `sw.js` の記述ミスによりオフライン時にサイトが開かなくなる可能性があるため、フォールバック（`fetch` へのパススルー）を確実に行う。
