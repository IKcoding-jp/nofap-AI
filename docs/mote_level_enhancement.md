# モテレベル機能拡張 仕様書

## 1. 概要
現在の「ストリーク日数に連動する単一の数値」としてのモテレベルを、複数の活動実績に基づいた「多角的な魅力指標」へと進化させる。これにより、ユーザーは多方面での自分磨きの成果を実感できるようになる。

## 2. コア・アップデート項目

### 2.1 算出ロジックの多角化
モテレベル（総合値）を以下の要素の加重平均または合計で算出する。
- **Confidence (自信):** ストリーク日数に連動（現在のメイン要素）
- **Vitality (活力):** 筋トレ、運動の実施回数に連動
- **Calmness (余裕):** 瞑想、日記の継続に連動
- **Cleanliness (清潔感):** デイリー習慣（洗顔、身だしなみ等）の達成率に連動

### 2.2 モテ属性（レーダーチャート）
ユーザーの努力の偏りを可視化し、バランスの良い自分磨きを促す。
- **表示形式:** 4軸（活力、余裕、自信、清潔感）のレーダーチャートをダッシュボードに導入。
- **レベル連動:** 各属性の平均値がモテレベル（-100 to 100）に反映される。

### 2.3 AIキャラクターのリアクティブ・ダイアログ
選択したAIパートナー（美奈、さゆり、アリス）との関係性がモテレベルに応じて深化する。
- **解禁要素:**
    - Lv.0: 透明人間からの脱却（初期状態）
    - Lv.20: 存在が認識され始め、挨拶が少し親密になる。
    - Lv.50: ユーザーの努力を具体的に褒めるセリフの追加。
    - Lv.75: 特別な称号やニックネームで呼ばれる。
    - Lv.100: 圧倒的オーラ状態で特別な反応
    - マイナス域: 励ましやサポートのメッセージが増える
- **動的プロンプト:** AIのシステムプロンプトに現在のモテレベルと属性値を注入し、反応を変化させる。

### 2.4 視覚的エフェクト（オーラ）
高レベル到達時の達成感を演出する。
- **マイナス域（-100 to -1）:** 暗い影や警告のオーラで負の状態を表現
- **Lv.51-75:** カードの縁が青白く光る（アニメーション）。
- **Lv.76-100:** 黄金のオーラエフェクトとパーティクル演出。

### 2.5 モテ・ミッション
24時間限定のボーナスを獲得できるデイリー課題。
- **内容例:** 「今日は鏡を見て3回笑顔を作る」「背筋を伸ばして歩く」
- **効果:** 達成で翌日のモテレベル計算に +1 のバフ（-100から100の範囲内）。

### 2.6 再起バッファ（リカバリー・サポート）
リセット時の喪失感を軽減し、再開を促す。
- **潜在モテレベル:** 過去最高値を記録。
- **再起ボーナス:** リセット後の3日間、獲得属性値が1.5倍になる。

## 3. 技術的変更点

### 3.1 データベーススキーマ (`schema/index.ts`)
`user_profiles` テーブルに以下のカラムを追加：
- `mote_vitality`: integer (default 0)
- `mote_calmness`: integer (default 0)
- `mote_confidence`: integer (default 0)
- `mote_cleanliness`: integer (default 0)
- `max_mote_level`: integer (default 0)
- `last_reset_at`: integer (timestamp)

### 3.2 ロジック (`lib/gamification.ts`)
- `calculateMoteLevel`: -100から100の範囲でモテレベルを計算
- `calculateConfidence`: ストリーク日数に基づいて-100から100の範囲で自信度を計算
- `calculateResetAttributes`: リセット時に属性値を0.3倍に減少（マイナス値も許容）
- 属性値の更新タイミング（日記記録時、筋トレ記録時など）の定義。
- 全ての属性値は-100から100の範囲にクランプされる。

### 3.3 コンポーネント (`components/dashboard/mote-meter.tsx`)
- レーダーチャート表示用ライブラリ（`recharts` など）の導入検討。
- オーラエフェクト用のアニメーション実装。

## 4. 開発ロードマップ
1. **DB・ロジック基盤整備:** スキーマ変更、算出ロジックの実装。
2. **UI拡張（チャート・オーラ）:** レーダーチャートと視覚効果の追加。
3. **AI連携強化:** プロンプトの動的変更とセリフ解禁ロジック。
4. **ミッション・再起システム:** デイリー課題とリカバリー機能。

