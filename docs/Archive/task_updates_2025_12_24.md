# 機能追加・アップデート要件定義 (2025-12-24)

本ドキュメントは、既存の「オナ禁サポートAI」に対する追加機能およびアップデート内容をまとめたものである。

## 1. AI機能の強化

### 1.1 チャット履歴の永続化
- **概要**: アプリを閉じてもAIとの会話履歴が保持され、再開時に過去のやり取りを確認できる。
- **詳細**: 
    - データベース（`ai_conversations`テーブル）に保存されている履歴を、チャット画面表示時に読み込む。
    - ページネーションまたはスクロールによる過去ログの読み込み機能。

### 1.2 AIメモリ（ユーザー情報の蓄積）
- **概要**: ユーザーの特性、目標、過去の失敗パターンなどをAIが「記憶」し、それを踏まえたパーソナライズされた会話を行う。
- **詳細**:
    - ユーザープロフィールや相談内容から重要な情報を抽出・保存する仕組み。
    - システムプロンプトに動的にユーザーの「メモリ」を注入する。

### 1.3 ペルソナ（性格）設定
- **概要**: AIの話し方や態度を、複数のプリセットから選択できる。
- **詳細**:
    - **ミナ (厳格な鬼教官)**: 「甘えは禁物よ。」規律を重視し、ユーザーを厳しく律する。
    - **サユリ (包容力のあるお姉さん)**: 「頑張ってるね、偉いよ。」優しく寄り添い、心のケアを重視する。
    - **アリス (理知的なメンター)**: 「データによれば、この時間は危険です。」冷静な分析と論理的なアドバイス。
    - ユーザー設定画面で切り替え可能にする。

### 1.4 AIによる日記の自動分析・要約・分類
- **概要**: 記入された日記から、反省点、改善点、その日の状態をAIが分析。
- **詳細**:
    - 日記投稿時にバックグラウンドで分析を実行。
    - 「感情分析」「失敗トリガーの特定」「翌日へのアドバイス」などを生成。
    - 日記一覧でAIによる短い要約とカテゴリ分類（ストレス、暇、自信、孤独など）を表示。

## 2. データ可視化・ゲーミフィケーション

### 2.1 レベル・称号システム
- **概要**: ユーザーの努力を数値化し、レベルと称号で成長を実感させる。
- **詳細**:
    - **レベル**: 無制限。
    - **経験値(XP)ロジック**: 
        - ストリーク継続（毎日）: 100 XP
        - 日記記入: 50 XP
        - 筋トレ/習慣達成: 30 XP
    - **称号**: 「勉強」「仕事」「恋愛」の3カテゴリ。各レベル到達で「見習い」「熟練」「マスター」等の称号を付与。

### 2.2 進化した「モテ度メーター」
- **概要**: 0から30までの「モテレベル」を導入し、細かな段階で成長を実感させる。
- **詳細**:
    - **レベル0-5 (導入期)**: 「透明人間からの脱却」
        - 0: 誰の視界にも入らない（透明人間状態）
        - 3: 街中で肩がぶつかりにくくなる
        - 5: 店員さんの対応が少し丁寧になる
    - **レベル6-15 (変化期)**: 「周囲の反応の変化」
        - 7: すれ違いざまに視線を感じる
        - 10: 知らない女性から道を尋ねられる
        - 13: 「何か雰囲気変わった？」と声をかけられる
    - **レベル16-25 (覚醒期)**: 「惹きつける力」
        - 18: 遠くの席の女性と頻繁に目が合う
        - 22: 初対面で好印象を抱かれる確率が激増
        - 25: 逆ナンや連絡先交換の打診を受ける
    - **レベル26-30 (極致期)**: 「圧倒的オーラ」
        - 28: 存在するだけで周囲の空気が変わる
        - 30: 惹きつけるオーラが最大化。もはや言葉不要のカリスマ状態。
    - **視覚演出**: レベルアップごとにメーターの色が変化し、主要な節目（5, 10, 20, 30）で専用のカットイン演出やイラストの変化を導入。

## 3. PWA（Progressive Web App）化
- **概要**: ホーム画面へのインストール、フルスクリーン表示。
- **詳細**:
    - `manifest.json`, Service Workerの導入。

## 4. 代替行動・習慣化サポート機能

### 4.1 瞑想・深呼吸タイマー
- **概要**: 誘惑をやり過ごすための専用ツール。
- **詳細**:
    - 3分/5分の瞑想タイマー（視覚的なカウントダウン）。
    - 深呼吸ガイド（サークルが拡大・縮小するアニメーション）。

### 4.2 筋トレカウンター・習慣管理
- **概要**: 腕立て、スクワット等の回数記録と習慣チェック。
- **詳細**:
    - **筋トレ**: プリセット（10, 20, 30, 50回）から選択し、完了ボタンでXP獲得。
    - **習慣リスト**: 読書、冷水シャワー、早起きなど、ユーザーがチェック可能にする。

---
## 実装優先順位（提案）

1. **AI基盤の強化**: チャット履歴保存、メモリ機能、ペルソナ設定（会話の質に直結するため）
2. **日記のAI分析**: 記録の価値を高める
3. **ゲーミフィケーション**: レベル・称号・モテ度（継続のモチベーション維持）
4. **PWA化**: 利用頻度の向上
5. **代替行動サポート**: 具体的なツールの提供

